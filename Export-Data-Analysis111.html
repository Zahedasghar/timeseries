<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Zahid Asghar">
<meta name="dcterms.date" content="2025-02-01">

<title>Exploring Export Data of Pakistan with its partner countries</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="Export-Data-Analysis111_files/libs/clipboard/clipboard.min.js"></script>
<script src="Export-Data-Analysis111_files/libs/quarto-html/quarto.js"></script>
<script src="Export-Data-Analysis111_files/libs/quarto-html/popper.min.js"></script>
<script src="Export-Data-Analysis111_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Export-Data-Analysis111_files/libs/quarto-html/anchor.min.js"></script>
<link href="Export-Data-Analysis111_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Export-Data-Analysis111_files/libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Export-Data-Analysis111_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Export-Data-Analysis111_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Export-Data-Analysis111_files/libs/bootstrap/bootstrap-8a79a254b8e706d3c925cde0a310d4f0.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Exploring Export Data of Pakistan with its partner countries</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Zahid Asghar </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 1, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p><img src="images/Export.jpg" class="img-fluid"></p>
<section id="why-r" class="level1">
<h1>Why R</h1>
<p>There is an increasing recognition of reproducibility of research, though it has limited recognition in social sciences. The document in your hand is written in <code>RMarkdown</code>. <code>RMarkown</code> which can be used for pdf, html, word, PowerPoint/Slidy/Beamer Presentations, Webpages, LaTex and many others. Besides learning basics of R-coding, another objective of this workshop is understanding the importance of reproducibility. Building this new habit of reproducible work at times maybe little challenging occasionally. Getting rid of culture of copying and pasting, and sparing this time for doing data analysis and research is one of the objectives of this or coming workshops. Purpose is to help you to get away from this tedious activity so that you can spend more time <strong>doing science</strong>.</p>
</section>
<section id="uploaded-data-and-required-r-packages" class="level1">
<h1>Uploaded data and required R packages</h1>
<p>Understanding data sets requires many hours/days or in some cases weeks.There are many commercially available software but open source community based software have now dominated and R is one of these. R makes data understanding process as easy as possible through the dplyr package. It is one of the easiest solution for code-based data analysis. We will learn in this training how to do it. I have already uploaded videos for downloading packages and relevant information. video links….</p>
<p>I will explore the <a href="https://wits.worldbank.org/countrystats.aspx?lang=en">Export Data</a> and will explain how one can use basic <strong>dplyr</strong> verbs for data wrangling. Here’s how to load in all required packages:</p>
<section id="exort-data-analysis" class="level2">
<h2 class="anchored" data-anchor-id="exort-data-analysis">Exort Data Analysis</h2>
<p>Rows: 92,950 Columns: 11 $ Nomenclature <chr> “H5”, “H5”, “H5”, “H5”, “H5”, “H5”, “H5”, “H5… $ ReporterISO3 <chr>”PAK”, “PAK”, “PAK”, “PAK”, “PAK”, “PAK”, “PA… $ ProductCode <dbl> 10221, 10221, 10239, 10511, 10511, 10599, 105… $ ReporterName <chr>”Pakistan”, “Pakistan”, “Pakistan”, “Pakistan… $ PartnerISO3 <chr>”AFG”, “SAU”, “AFG”, “AFG”, “OMN”, “AFG”, “OM… $ PartnerName <chr>”Afghanistan”, “Saudi Arabia”, “Afghanistan”,… $ Year <dbl> 2017, 2017, 2017, 2017, 2017, 2017, 2017, 201… $ TradeFlowName <chr> “Export”, “Export”, “Export”, “Export”, “Expo… $ TradeFlowCode <dbl> 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, … $ <code>TradeValue in 1000 USD</code> <dbl> 240.335, 0.000, 422.272, 380.257, 0.799, 3416… $ value_1000_USD <dbl> 240.335, 0.000, 422.272, 380.257, 0.799, 3416…</dbl></dbl></dbl></chr></dbl></chr></chr></chr></dbl></chr></chr></p>
<p>Once data are uploaded, now to get an overview of this data, we display first few rows of data by recalling <strong>X_pk</strong> data. <strong>glimpse</strong> command helps to get an overall view of this data. <strong>str</strong> command will also describe data.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  ProductCode value_1000_USD PartnerName  ReporterName
        &lt;dbl&gt;          &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;       
1       10221        240.    Afghanistan  Pakistan    
2       10221          0     Saudi Arabia Pakistan    
3       10239        422.    Afghanistan  Pakistan    
4       10511        380.    Afghanistan  Pakistan    
5       10511          0.799 Oman         Pakistan    
6       10599       3417.    Afghanistan  Pakistan    </code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 92,950
Columns: 11
$ Nomenclature             &lt;chr&gt; "H5", "H5", "H5", "H5", "H5", "H5", "H5", "H5…
$ ReporterISO3             &lt;chr&gt; "PAK", "PAK", "PAK", "PAK", "PAK", "PAK", "PA…
$ ProductCode              &lt;dbl&gt; 10221, 10221, 10239, 10511, 10511, 10599, 105…
$ ReporterName             &lt;chr&gt; "Pakistan", "Pakistan", "Pakistan", "Pakistan…
$ PartnerISO3              &lt;chr&gt; "AFG", "SAU", "AFG", "AFG", "OMN", "AFG", "OM…
$ PartnerName              &lt;chr&gt; "Afghanistan", "Saudi Arabia", "Afghanistan",…
$ Year                     &lt;dbl&gt; 2017, 2017, 2017, 2017, 2017, 2017, 2017, 201…
$ TradeFlowName            &lt;chr&gt; "Export", "Export", "Export", "Export", "Expo…
$ TradeFlowCode            &lt;dbl&gt; 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, …
$ `TradeValue in 1000 USD` &lt;dbl&gt; 240.335, 0.000, 422.272, 380.257, 0.799, 3416…
$ value_1000_USD           &lt;dbl&gt; 240.335, 0.000, 422.272, 380.257, 0.799, 3416…</code></pre>
</div>
</div>
<p>This indicate that there are 10 variables and 92951 observations. From having an overview of above mentioned variables, we are interested to select few of these variables. For this we use one of the verb <strong>select</strong> as follows:</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Export in thousad of USD</caption>
<thead>
<tr class="header">
<th style="text-align: left;">ReporterName</th>
<th style="text-align: left;">PartnerName</th>
<th style="text-align: right;">value_1000_USD</th>
<th style="text-align: right;">ProductCode</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Pakistan</td>
<td style="text-align: left;">Afghanistan</td>
<td style="text-align: right;">240.335</td>
<td style="text-align: right;">10221</td>
</tr>
<tr class="even">
<td style="text-align: left;">Pakistan</td>
<td style="text-align: left;">Saudi Arabia</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">10221</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Pakistan</td>
<td style="text-align: left;">Afghanistan</td>
<td style="text-align: right;">422.272</td>
<td style="text-align: right;">10239</td>
</tr>
<tr class="even">
<td style="text-align: left;">Pakistan</td>
<td style="text-align: left;">Afghanistan</td>
<td style="text-align: right;">380.257</td>
<td style="text-align: right;">10511</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Pakistan</td>
<td style="text-align: left;">Oman</td>
<td style="text-align: right;">0.799</td>
<td style="text-align: right;">10511</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Or we can drop variables which are not required by using the same <strong>select</strong> verb but with -ve signs for the variables which we want to drop.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 8
  ProductCode ReporterName PartnerName   Year TradeFlowName TradeFlowCode
        &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;        &lt;dbl&gt; &lt;chr&gt;                 &lt;dbl&gt;
1       10221 Pakistan     Afghanistan   2017 Export                    6
2       10221 Pakistan     Saudi Arabia  2017 Export                    6
3       10239 Pakistan     Afghanistan   2017 Export                    6
4       10511 Pakistan     Afghanistan   2017 Export                    6
5       10511 Pakistan     Oman          2017 Export                    6
6       10599 Pakistan     Afghanistan   2017 Export                    6
# ℹ 2 more variables: `TradeValue in 1000 USD` &lt;dbl&gt;, value_1000_USD &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Wait a minute, despite selection of desired variables or droping undesired variables, we have not lost orginal data. This is a very unique feature unlike some softwares where if we drop some variables, we cant re-use those unless we go back and open original file. If we type <strong>X_pk</strong> we will get same data having 10 variables with 92,951 rows.</p>
</section>
<section id="filter-and-select-verb" class="level2">
<h2 class="anchored" data-anchor-id="filter-and-select-verb">Filter and select verb</h2>
<p>One may use <strong>filter</strong> command to keep observations meeting certain criteria and then use <strong>select</strong> for keeping desired variables.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  ReporterName PartnerName          value_1000_USD ProductCode
  &lt;chr&gt;        &lt;chr&gt;                         &lt;dbl&gt;       &lt;dbl&gt;
1 Pakistan     Afghanistan                   15.2        10190
2 Pakistan     Saudi Arabia                   0          10221
3 Pakistan     Saudi Arabia                   0          10290
4 Pakistan     United Arab Emirates          29.5        10410
5 Pakistan     Saudi Arabia                   0          10410
6 Pakistan     Afghanistan                    8.93       10420</code></pre>
</div>
</div>
<p>This table shows data only for 2018 year and have four variables selected.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  ProductCode Nomenclature value_1000_USD
        &lt;dbl&gt; &lt;chr&gt;                 &lt;dbl&gt;
1       30199 H5                   709.  
2       30219 H5                     5.07
3       30223 H5                    11.4 
4       30229 H5                     8.57
5       30243 H5                     1.68
6       30285 H5                    36.2 </code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  ReporterName PartnerName   value_1000_USD ProductCode
  &lt;chr&gt;        &lt;chr&gt;                  &lt;dbl&gt;       &lt;dbl&gt;
1 Pakistan     China                 709.         30199
2 Pakistan     United States          24.3        30199
3 Pakistan     China                   5.07       30219
4 Pakistan     China                  11.4        30223
5 Pakistan     China                   8.57       30229
6 Pakistan     United States          14.0        30229</code></pre>
</div>
</div>
</section>
<section id="ordering-by-using-arranage-function" class="level2">
<h2 class="anchored" data-anchor-id="ordering-by-using-arranage-function">Ordering by using arranage function</h2>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  ReporterName PartnerName    value_1000_USD ProductCode
  &lt;chr&gt;        &lt;chr&gt;                   &lt;dbl&gt;       &lt;dbl&gt;
1 Pakistan     China                 586099.      520512
2 Pakistan     United States         379967.      620322
3 Pakistan     United States         345159.      630710
4 Pakistan     United States         337448.      630260
5 Pakistan     United Kingdom        219605.      630239
6 Pakistan     United States         215608.      630210</code></pre>
</div>
</div>
</section>
<section id="group_by-and-summarising" class="level2">
<h2 class="anchored" data-anchor-id="group_by-and-summarising">group_by and summarising</h2>
</section>
<section id="rename-variables" class="level2">
<h2 class="anchored" data-anchor-id="rename-variables">Rename variables</h2>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Export-Data-Analysis111_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="614"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  PartnerName         sum
  &lt;chr&gt;             &lt;dbl&gt;
1 China          1754391.
2 United Kingdom 1715553.
3 United States  3779145.</code></pre>
</div>
</div>
</section>
<section id="arrange-and-arrangedesc-for-each-year" class="level2">
<h2 class="anchored" data-anchor-id="arrange-and-arrangedesc-for-each-year">Arrange and Arrange(desc()) For each year</h2>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
# Groups:   PartnerName [3]
  PartnerName     Year      sum
  &lt;chr&gt;          &lt;dbl&gt;    &lt;dbl&gt;
1 United States   2019 4007399.
2 United States   2018 3779145.
3 United States   2017 3546689.
4 China           2019 1997217.
5 China           2018 1754391.
6 United Kingdom  2018 1715553.</code></pre>
</div>
</div>
</section>
<section id="group-by-product-name" class="level2">
<h2 class="anchored" data-anchor-id="group-by-product-name">Group by product name</h2>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2,942 × 3
# Groups:   ProductCode [1,733]
   ProductCode PartnerName        sum
         &lt;dbl&gt; &lt;chr&gt;            &lt;dbl&gt;
 1      520512 China          565848.
 2      620322 United States  401733.
 3      630260 United States  333286.
 4      630710 United States  318770.
 5      740319 China          258740.
 6      100630 China          241029.
 7      630210 United States  234804.
 8      630239 United Kingdom 215302.
 9      630239 United States  143067.
10      620322 United Kingdom 142536.
# ℹ 2,932 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
      sum
    &lt;dbl&gt;
1 406685.</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10,516 × 3
# Groups:   ProductCode [3,037]
   ProductCode PartnerName          Total_value
         &lt;dbl&gt; &lt;chr&gt;                      &lt;dbl&gt;
 1      520512 China                    565848.
 2      620322 United States            401733.
 3      630260 United States            333286.
 4      630710 United States            318770.
 5      740319 China                    258740.
 6      620322 Spain                    255310.
 7      520942 Bangladesh               252258.
 8      100630 China                    241029.
 9      630210 United States            234804.
10      100630 United Arab Emirates     229240.
# ℹ 10,506 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2,831 × 3
# Groups:   PartnerName [194]
   PartnerName   ProductCode    sum
   &lt;chr&gt;               &lt;dbl&gt;  &lt;dbl&gt;
 1 Guinea-Bissau      100640 18013.
 2 Comoros            100630 10115.
 3 Comoros            252329  3681.
 4 Guinea-Bissau      100630  3478.
 5 Occ.Pal.Terr       100630  1239.
 6 Gabon              630239   605.
 7 Eritrea            210690   473.
 8 Eritrea            220710   303.
 9 Cuba               630260   248.
10 Cuba               520822   240.
# ℹ 2,821 more rows</code></pre>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>